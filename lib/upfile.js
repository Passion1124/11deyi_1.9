"use strict";(function(){function a(A){var z=A.file,v=A.dir||"",h=A.token,e=A.callback||function(){},c=A.retries||0,d=A.maxSize||0,y=A.name||z.name,n="http://upload.media.aliyun.com/api/proxy/upload",p="http://upload.media.aliyun.com/api/proxy/blockInit",g="http://upload.media.aliyun.com/api/proxy/blockUpload",w="http://upload.media.aliyun.com/api/proxy/blockComplete",i=A.chunkSize||4*1024*1024,f=0,b=z,u,m,s=[],o=[],x=[];function l(B,E,D,C){if(c-->0&&!E&&C!=599){if(z.size>i){t(D,o[D],x[D])}else{j()}}else{e(-1,B)}}function r(){var C=0,B;while(C<b.size){B=Math.min(i,b.size-C);o.push(B);x.push(b.slice(C,C+B));C+=B}t(0,o[0],x[0])}function t(E,C,B){var F=new FormData();F.append("size",C);var D;if(E==0){F.append("dir",v);F.append("name",y);D=p}else{F.append("id",u);F.append("uploadId",m);F.append("partNumber",E+1);D=g}F.append("content",B,b.name);q(D,F,function(L){var H=L.status,K=L.statusText||"";if(H==200&&K=="OK"){var G=JSON.parse(L.responseText);s[E]=G.eTag;f+=C;var J=Math.ceil(f/z.size*100);e(J);if(E==0){u=G.id;m=G.uploadId;for(var I=1;I<x.length;I++){t(I,o[I],x[I])}}if(f>=b.size){b=null;B=F=null;k()}}else{l(JSON.parse(L.responseText),0,E,H)}})}function k(){var D=[];for(var B=0;B<s.length;B++){D[B]={partNumber:B+1,eTag:s[B]}}D=btoa(JSON.stringify(D));var C=new FormData();C.append("id",u);C.append("uploadId",m);C.append("parts",D);q(w,C,function(G){var E=G.status,F=G.statusText||"";if(E==200&&F=="OK"){e(100,JSON.parse(G.responseText))}else{l(JSON.parse(G.responseText),1,"",E)}})}function j(){var C=new FormData();C.append("dir",v);C.append("name",y);C.append("size",z.size);C.append("content",z);var B=n;q(B,C,function(F){var D=F.status,E=F.statusText||"";if(D==200&&E=="OK"){e(100,JSON.parse(F.responseText))}else{l(JSON.parse(F.responseText),"","",D)}})}function q(C,F,B){var D=new XMLHttpRequest();var E="Authorization="+h+"&UserAgent=ALIMEDIASDK_WORKSTATION";if(C.indexOf("?")>-1){C+="&"+E}else{C+="?"+E}D.open("POST",C);D.onload=function(G){B(D)};D.send(F)}if(!z||!h){e(-1,"上传文件参数必须配置file以及token");return}if(d&&z.size>d){e(-1,"文件大小不能超过"+d);return}if(z.size>i){r()}else{j()}}this.uploadJSSDK=a}).call(this);