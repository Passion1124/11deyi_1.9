(function(a){var b={};function c(e){if(b[e]){return b[e].exports}var d=b[e]={exports:{},id:e,loaded:false};a[e].call(d.exports,d,d.exports,c);d.loaded=true;return d.exports}c.m=a;c.c=b;c.p="./";return c(0)})({0:function(module,exports,__webpack_require__){(function(window,undefined){var _version="1.1.2";var _code=__webpack_require__(210).code;var _utils=__webpack_require__(211).utils;var _msg=__webpack_require__(212);var _message=_msg._msg;var _msgHash={};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;if(window.XDomainRequest){XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send;XDomainRequest.prototype.send=function(){XDomainRequest.prototype.oldsend.apply(this,arguments);this.readyState=2}}Strophe.Request.prototype._newXHR=function(){var xhr=_utils.xmlrequest(true);if(xhr.overrideMimeType){xhr.overrideMimeType("text/xml")}xhr.onreadystatechange=this.func.stropheBind(null,this);return xhr};Strophe.Websocket.prototype._closeSocket=function(){var me=this;if(me.socket){setTimeout(function(){try{me.socket.close()}catch(e){}},0)}else{me.socket=null}};var _networkSt;var _listenNetwork=function _listenNetwork(onlineCallback,offlineCallback){if(window.addEventListener){window.addEventListener("online",onlineCallback);window.addEventListener("offline",offlineCallback)}else{if(window.attachEvent){if(document.body){document.body.attachEvent("onoffline",offlineCallback);document.body.attachEvent("onoffline",offlineCallback)}else{window.attachEvent("load",function(){document.body.attachEvent("onoffline",offlineCallback);document.body.attachEvent("onoffline",offlineCallback)})}}else{}}};var _parseRoom=function _parseRoom(result){var rooms=[];var items=result.getElementsByTagName("item");if(items){for(var i=0;i<items.length;i++){var item=items[i];var roomJid=item.getAttribute("jid");var tmp=roomJid.split("@")[0];var room={jid:roomJid,name:item.getAttribute("name"),roomId:tmp.split("_")[1]};rooms.push(room)}}return rooms};var _parseRoomOccupants=function _parseRoomOccupants(result){var occupants=[];var items=result.getElementsByTagName("item");if(items){for(var i=0;i<items.length;i++){var item=items[i];var room={jid:item.getAttribute("jid"),name:item.getAttribute("name")};occupants.push(room)}}return occupants};var _parseResponseMessage=function _parseResponseMessage(msginfo){var parseMsgData={errorMsg:true,data:[]};var msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i];var childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=eval("("+jsondata+")");parseMsgData.errorMsg=false;parseMsgData.data=[data]}catch(e){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0];var delayMsgTime=delayTag.getAttribute("stamp");if(delayMsgTime){parseMsgData.delayTimeStamp=delayMsgTime}}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT){try{var data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=false;parseMsgData.data=[data]}catch(e){}}}}return parseMsgData};var _parseNameFromJidFn=function _parseNameFromJidFn(jid,domain){domain=domain||"";var tempstr=jid;var findex=tempstr.indexOf("_");if(findex!==-1){tempstr=tempstr.substring(findex+1)}var atindex=tempstr.indexOf("@"+domain);if(atindex!==-1){tempstr=tempstr.substring(0,atindex)}return tempstr};var _parseFriend=function _parseFriend(queryTag){var rouster=[];var items=queryTag.getElementsByTagName("item");if(items){for(var i=0;i<items.length;i++){var item=items[i];var jid=item.getAttribute("jid");if(!jid){continue}var subscription=item.getAttribute("subscription");var friend={subscription:subscription,jid:jid};var ask=item.getAttribute("ask");if(ask){friend.ask=ask}var name=item.getAttribute("name");if(name){friend.name=name}else{var n=_parseNameFromJidFn(jid);friend.name=n}var groups=[];Strophe.forEachChild(item,"group",function(group){groups.push(Strophe.getText(group))});friend.groups=groups;rouster.push(friend)}}return rouster};var _login=function _login(options,conn){var accessToken=options.access_token||"";if(accessToken==""){var loginfo=_utils.stringify(options);conn.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:options,xhr:xhr});return}conn.context.accessToken=options.access_token;conn.context.accessTokenExpires=options.expires_in;var stropheConn=null;if(conn.isOpening()&&conn.context.stropheConn){stropheConn=conn.context.stropheConn}else{if(conn.isOpened()&&conn.context.stropheConn){return}else{stropheConn=new Strophe.Connection(conn.url,{inactivity:conn.inactivity,maxRetries:conn.maxRetries,pollingTime:conn.pollingTime})}}var callback=function callback(status,msg){_loginCallback(status,msg,conn)};conn.context.stropheConn=stropheConn;if(conn.route){stropheConn.connect(conn.context.jid,"$t$"+accessToken,callback,conn.wait,conn.hold,conn.route)}else{stropheConn.connect(conn.context.jid,"$t$"+accessToken,callback,conn.wait,conn.hold)}};var _parseMessageType=function _parseMessageType(msginfo){var msgtype="normal";var receiveinfo=msginfo.getElementsByTagName("received");if(receiveinfo&&receiveinfo.length>0&&receiveinfo[0].namespaceURI==="urn:xmpp:receipts"){msgtype="received"}else{var inviteinfo=msginfo.getElementsByTagName("invite");if(inviteinfo&&inviteinfo.length>0){msgtype="invite"}}return msgtype};var _handleMessageQueue=function _handleMessageQueue(conn){for(var i in _msgHash){if(_msgHash.hasOwnProperty(i)){_msgHash[i].send(conn)}}};var _loginCallback=function _loginCallback(status,msg,conn){if(status==Strophe.Status.CONNFAIL){conn.onError({type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:msg,reconnect:true})}else{if(status==Strophe.Status.ATTACHED||status==Strophe.Status.CONNECTED){var handleMessage=function handleMessage(msginfo){var type=_parseMessageType(msginfo);if("received"===type){conn.handleReceivedMessage(msginfo);return true}else{if("invite"===type){conn.handleInviteMessage(msginfo);return true}else{conn.handleMessage(msginfo);return true}}};var handlePresence=function handlePresence(msginfo){conn.handlePresence(msginfo);return true};var handlePing=function handlePing(msginfo){conn.handlePing(msginfo);return true};var handleIq=function handleIq(msginfo){conn.handleIq(msginfo);return true};conn.addHandler(handleMessage,null,"message",null,null,null);conn.addHandler(handlePresence,null,"presence",null,null,null);conn.addHandler(handlePing,"urn:xmpp:ping","iq","get",null,null);conn.addHandler(handleIq,"jabber:iq:roster","iq","set",null,null);conn.context.status=_code.STATUS_OPENED;var supportRecMessage=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI];if(_utils.isCanDownLoadFile){supportRecMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);supportRecMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)}var supportSedMessage=[_code.WEBIM_MESSAGE_SED_TEXT];if(_utils.isCanUploadFile){supportSedMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);supportSedMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)}conn.notifyVersion();conn.retry&&_handleMessageQueue(conn);conn.heartBeat();conn.isAutoLogin&&conn.setPresence();conn.onOpened({canReceive:supportRecMessage,canSend:supportSedMessage,accessToken:conn.context.accessToken})}else{if(status==Strophe.Status.DISCONNECTING){if(conn.isOpened()){conn.stopHeartBeat();conn.context.status=_code.STATUS_CLOSING;conn.onError({type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:msg,reconnect:true})}}else{if(status==Strophe.Status.DISCONNECTED){conn.context.status=_code.STATUS_CLOSED;conn.clear();conn.onClosed()}else{if(status==Strophe.Status.AUTHFAIL){conn.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});conn.clear()}else{if(status==Strophe.Status.ERROR){conn.onError({type:_code.WEBIM_CONNCTION_SERVER_ERROR})}}}}}}};var _getJid=function _getJid(options,conn){var jid=options.toJid||"";if(jid===""){var appKey=conn.context.appKey||"";var toJid=appKey+"_"+options.to+"@"+conn.domain;if(options.resource){toJid=toJid+"/"+options.resource}jid=toJid}return jid};var _validCheck=function _validCheck(options,conn){options=options||{};if(options.user==""){conn.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR});return false}var user=options.user+""||"";var appKey=options.appKey||"";var devInfos=appKey.split("#");if(devInfos.length!==2){conn.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});return false}var orgName=devInfos[0];var appName=devInfos[1];if(!orgName){conn.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});return false}if(!appName){conn.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});return false}var jid=appKey+"_"+user.toLowerCase()+"@"+conn.domain,resource=options.resource||"webim";if(conn.isMultiLoginSessions){resource+=user+new Date().getTime()+Math.floor(Math.random().toFixed(6)*1000000)}conn.context.jid=jid+"/"+resource;conn.context.userId=user;conn.context.appKey=appKey;conn.context.appName=appName;conn.context.orgName=orgName;return true};var _getXmppUrl=function _getXmppUrl(baseUrl,https){if(/^(ws|http)s?:\/\/?/.test(baseUrl)){return baseUrl}var url={prefix:"http",base:"://"+baseUrl,suffix:"/http-bind/"};if(https&&_utils.isSupportWss){url.prefix="wss";url.suffix="/ws/"}else{if(https){url.prefix="https"}else{if(window.WebSocket){url.prefix="ws";url.suffix="/ws/"}}}return url.prefix+url.base+url.suffix};var connection=function connection(options){if(!this instanceof connection){return new connection(options)}var options=options||{};this.isMultiLoginSessions=options.isMultiLoginSessions||false;this.wait=options.wait||30;this.retry=options.retry||false;this.https=options.https||location.protocol==="https:";this.url=_getXmppUrl(options.url,this.https);this.hold=options.hold||1;this.route=options.route||null;this.domain=options.domain||"easemob.com";this.inactivity=options.inactivity||30;this.heartBeatWait=options.heartBeatWait||60000;this.maxRetries=options.maxRetries||5;this.isAutoLogin=options.isAutoLogin===false?false:true;this.pollingTime=options.pollingTime||800;this.stropheConn=false;this.context={status:_code.STATUS_INIT}};connection.prototype.listen=function(options){options.url&&(this.url=_getXmppUrl(options.url,this.https));this.onOpened=options.onOpened||_utils.emptyfn;this.onClosed=options.onClosed||_utils.emptyfn;this.onTextMessage=options.onTextMessage||_utils.emptyfn;this.onEmojiMessage=options.onEmojiMessage||_utils.emptyfn;this.onPictureMessage=options.onPictureMessage||_utils.emptyfn;this.onAudioMessage=options.onAudioMessage||_utils.emptyfn;this.onVideoMessage=options.onVideoMessage||_utils.emptyfn;this.onFileMessage=options.onFileMessage||_utils.emptyfn;this.onLocationMessage=options.onLocationMessage||_utils.emptyfn;this.onCmdMessage=options.onCmdMessage||_utils.emptyfn;this.onPresence=options.onPresence||_utils.emptyfn;this.onRoster=options.onRoster||_utils.emptyfn;this.onError=options.onError||_utils.emptyfn;this.onReceivedMessage=options.onReceivedMessage||_utils.emptyfn;this.onInviteMessage=options.onInviteMessage||_utils.emptyfn;this.onOffline=options.onOffline||_utils.emptyfn;this.onOnline=options.onOnline||_utils.emptyfn;_listenNetwork(this.onOnline,this.onOffline)};connection.prototype.heartBeat=function(){var me=this;if(me.heartBeatID){return}var options={to:me.domain,type:"normal"};me.heartBeatID=setInterval(function(){me.sendHeartBeatMessage(options)},me.heartBeatWait)};connection.prototype.sendHeartBeatMessage=function(options){var json={},jsonstr=_utils.stringify(json),dom=$msg({to:options.to,type:options.type,id:this.getUniqueId(),xmlns:"jabber:client"}).c("body").t(jsonstr);this.sendCommand(dom.tree())};connection.prototype.stopHeartBeat=function(){this.heartBeatID=clearInterval(this.heartBeatID)};connection.prototype.sendReceiptsMessage=function(options){var dom=$msg({from:this.context.jid||"",to:this.domain,id:options.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:options.id||""});this.sendCommand(dom.tree())};connection.prototype.open=function(options){var pass=_validCheck(options,this);if(!pass){return}var conn=this;if(conn.isOpening()||conn.isOpened()){return}if(options.accessToken){options.access_token=options.accessToken;_login(options,conn)}else{var apiUrl=options.apiUrl;var userId=this.context.userId;var pwd=options.pwd||"";var appName=this.context.appName;var orgName=this.context.orgName;var suc=function suc(data,xhr){conn.context.status=_code.STATUS_DOLOGIN_IM;_login(data,conn)};var error=function error(res,xhr,msg){conn.clear();if(res.error&&res.error_description){conn.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:res,xhr:xhr})}else{conn.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:res,xhr:xhr})}};this.context.status=_code.STATUS_DOLOGIN_USERGRID;var loginJson={grant_type:"password",username:userId,password:pwd};var loginfo=_utils.stringify(loginJson);var options={url:apiUrl+"/"+orgName+"/"+appName+"/token",dataType:"json",data:loginfo,success:suc||_utils.emptyfn,error:error||_utils.emptyfn};_utils.ajax(options)}};connection.prototype.attach=function(options){var pass=_validCheck(options,this);if(!pass){return}options=options||{};var accessToken=options.accessToken||"";if(accessToken==""){this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});return}var sid=options.sid||"";if(sid===""){this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});return}var rid=options.rid||"";if(rid===""){this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});return}var stropheConn=new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime});this.context.accessToken=accessToken;this.context.stropheConn=stropheConn;this.context.status=_code.STATUS_DOLOGIN_IM;var conn=this;var callback=function callback(status,msg){_loginCallback(status,msg,conn)};var jid=this.context.jid;var wait=this.wait;var hold=this.hold;var wind=this.wind||5;stropheConn.attach(jid,sid,rid,callback,wait,hold,wind)};connection.prototype.close=function(){var status=this.context.status;if(status==_code.STATUS_INIT){return}if(this.isClosed()||this.isClosing()){return}this.stopHeartBeat();this.context.status=_code.STATUS_CLOSING;this.context.stropheConn.disconnect()};connection.prototype.addHandler=function(handler,ns,name,type,id,from,options){this.context.stropheConn.addHandler(handler,ns,name,type,id,from,options)};connection.prototype.notifyVersion=function(suc,fail){var jid=_getJid({},this);var dom=$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim");var suc=suc||_utils.emptyfn;var error=fail||this.onError;var failFn=function failFn(ele){error({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:ele})};this.context.stropheConn.sendIQ(dom.tree(),suc,failFn);return};connection.prototype.handlePresence=function(msginfo){if(this.isClosed()){return}var from=msginfo.getAttribute("from")||"";var to=msginfo.getAttribute("to")||"";var type=msginfo.getAttribute("type")||"";var presence_type=msginfo.getAttribute("presence_type")||"";var fromUser=_parseNameFromJidFn(from);var toUser=_parseNameFromJidFn(to);var info={from:fromUser,to:toUser,fromJid:from,toJid:to,type:type,chatroom:msginfo.getElementsByTagName("roomtype").length?true:false};var showTags=msginfo.getElementsByTagName("show");if(showTags&&showTags.length>0){var showTag=showTags[0];info.show=Strophe.getText(showTag)}var statusTags=msginfo.getElementsByTagName("status");if(statusTags&&statusTags.length>0){var statusTag=statusTags[0];info.status=Strophe.getText(statusTag);info.code=statusTag.getAttribute("code")}var priorityTags=msginfo.getElementsByTagName("priority");if(priorityTags&&priorityTags.length>0){var priorityTag=priorityTags[0];info.priority=Strophe.getText(priorityTag)}var error=msginfo.getElementsByTagName("error");if(error&&error.length>0){var error=error[0];info.error={code:error.getAttribute("code")}}var destroy=msginfo.getElementsByTagName("destroy");if(destroy&&destroy.length>0){var destroy=destroy[0];info.destroy=true;var reason=destroy.getElementsByTagName("reason");if(reason&&reason.length>0){info.reason=Strophe.getText(reason[0])}}if(info.chatroom){var reflectUser=from.slice(from.lastIndexOf("/")+1);if(reflectUser===this.context.userId){if(info.type===""&&!info.code){info.type="joinChatRoomSuccess"}else{if(presence_type==="unavailable"||info.type==="unavailable"){if(!info.status){info.type="leaveChatRoom"}else{if(info.code==110){info.type="leaveChatRoom"}else{if(info.error&&info.error.code==406){info.type="reachChatRoomCapacity"}}}}}}}else{if(presence_type==="unavailable"||type==="unavailable"){if(info.destroy){info.type="deleteGroupChat"}else{if(info.code==307||info.code==321){info.type="leaveGroup"}}}}this.onPresence(info,msginfo)};connection.prototype.handlePing=function(e){if(this.isClosed()){return}var id=e.getAttribute("id");var from=e.getAttribute("from");var to=e.getAttribute("to");var dom=$iq({from:to,to:from,id:id,type:"result"});this.sendCommand(dom.tree())};connection.prototype.handleIq=function(e){var id=e.getAttribute("id");var from=e.getAttribute("from")||"";var name=_parseNameFromJidFn(from);var curJid=this.context.jid;var curUser=this.context.userId;var iqresult=$iq({type:"result",id:id,from:curJid});this.sendCommand(iqresult.tree());var msgBodies=e.getElementsByTagName("query");if(msgBodies&&msgBodies.length>0){var queryTag=msgBodies[0];var rouster=_parseFriend(queryTag);this.onRoster(rouster)}return true};connection.prototype.handleMessage=function(msginfo){if(this.isClosed()){return}var id=msginfo.getAttribute("id")||"";this.sendReceiptsMessage({id:id});var parseMsgData=_parseResponseMessage(msginfo);if(parseMsgData.errorMsg){this.handlePresence(msginfo);return}var msgDatas=parseMsgData.data;for(var i in msgDatas){if(!msgDatas.hasOwnProperty(i)){continue}var msg=msgDatas[i];if(!msg.from||!msg.to){continue}var from=(msg.from+"").toLowerCase();var too=(msg.to+"").toLowerCase();var extmsg=msg.ext||{};var chattype="";var typeEl=msginfo.getElementsByTagName("roomtype");if(typeEl.length){chattype=typeEl[0].getAttribute("type")||"chat"}else{chattype=msginfo.getAttribute("type")||"chat"}var msgBodies=msg.bodies;if(!msgBodies||msgBodies.length==0){continue}var msgBody=msg.bodies[0];var type=msgBody.type;try{switch(type){case"txt":var receiveMsg=msgBody.msg;var emojibody=_utils.parseTextMessage(receiveMsg,WebIM.Emoji);if(emojibody.isemoji){var msg={id:id,type:chattype,from:from,to:too,delay:parseMsgData.delayTimeStamp,data:emojibody.body,ext:extmsg};!msg.delay&&delete msg.delay;this.onEmojiMessage(msg)}else{var msg={id:id,type:chattype,from:from,to:too,delay:parseMsgData.delayTimeStamp,data:receiveMsg,ext:extmsg};!msg.delay&&delete msg.delay;this.onTextMessage(msg)}break;case"img":var rwidth=0;var rheight=0;if(msgBody.size){rwidth=msgBody.size.width;rheight=msgBody.size.height}var msg={id:id,type:chattype,from:from,to:too,url:msgBody.url,secret:msgBody.secret,filename:msgBody.filename,thumb:msgBody.thumb,thumb_secret:msgBody.thumb_secret,file_length:msgBody.file_length||"",width:rwidth,height:rheight,filetype:msgBody.filetype||"",accessToken:this.context.accessToken||"",ext:extmsg,delay:parseMsgData.delayTimeStamp};!msg.delay&&delete msg.delay;this.onPictureMessage(msg);break;case"audio":var msg={id:id,type:chattype,from:from,to:too,url:msgBody.url,secret:msgBody.secret,filename:msgBody.filename,length:msgBody.length||"",file_length:msgBody.file_length||"",filetype:msgBody.filetype||"",accessToken:this.context.accessToken||"",ext:extmsg,delay:parseMsgData.delayTimeStamp};!msg.delay&&delete msg.delay;this.onAudioMessage(msg);break;case"file":var msg={id:id,type:chattype,from:from,to:too,url:msgBody.url,secret:msgBody.secret,filename:msgBody.filename,file_length:msgBody.file_length,accessToken:this.context.accessToken||"",ext:extmsg,delay:parseMsgData.delayTimeStamp};!msg.delay&&delete msg.delay;this.onFileMessage(msg);break;case"loc":var msg={id:id,type:chattype,from:from,to:too,addr:msgBody.addr,lat:msgBody.lat,lng:msgBody.lng,ext:extmsg,delay:parseMsgData.delayTimeStamp};!msg.delay&&delete msg.dealy;this.onLocationMessage(msg);break;case"video":var msg={id:id,type:chattype,from:from,to:too,url:msgBody.url,secret:msgBody.secret,filename:msgBody.filename,file_length:msgBody.file_length,accessToken:this.context.accessToken||"",ext:extmsg,delay:parseMsgData.delayTimeStamp};!msg.delay&&delete msg.dealy;this.onVideoMessage(msg);break;case"cmd":var msg={id:id,from:from,to:too,action:msgBody.action,ext:extmsg,delay:parseMsgData.delayTimeStamp};!msg.delay&&delete msg.dealy;this.onCmdMessage(msg);break}}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}};connection.prototype.handleReceivedMessage=function(message){try{this.onReceivedMessage(message)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}var rcv=message.getElementsByTagName("received"),id,mid;if(rcv.length>0){if(rcv[0].childNodes&&rcv[0].childNodes.length>0){id=rcv[0].childNodes[0].nodeValue}else{id=rcv[0].innerHTML||rcv[0].innerText}mid=rcv[0].getAttribute("mid")}if(_msgHash[id]){try{_msgHash[id].msg.success instanceof Function&&_msgHash[id].msg.success(id,mid)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}delete _msgHash[id]}};connection.prototype.handleInviteMessage=function(message){var form=null;var invitemsg=message.getElementsByTagName("invite");var id=message.getAttribute("id")||"";this.sendReceiptsMessage({id:id});if(invitemsg&&invitemsg.length>0){var fromJid=invitemsg[0].getAttribute("from");form=_parseNameFromJidFn(fromJid)}var xmsg=message.getElementsByTagName("x");var roomid=null;if(xmsg&&xmsg.length>0){for(var i=0;i<xmsg.length;i++){if("jabber:x:conference"===xmsg[i].namespaceURI){var roomjid=xmsg[i].getAttribute("jid");roomid=_parseNameFromJidFn(roomjid)}}}this.onInviteMessage({type:"invite",from:form,roomid:roomid})};connection.prototype.sendCommand=function(dom,id){if(this.isOpened()){this.context.stropheConn.send(dom)}else{this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED,reconnect:true})}};connection.prototype.getUniqueId=function(prefix){var cdate=new Date();var offdate=new Date(2010,1,1);var offset=cdate.getTime()-offdate.getTime();var hexd=parseInt(offset).toString(16);if(typeof prefix==="string"||typeof prefix==="number"){return prefix+"_"+hexd}else{return"WEBIM_"+hexd}};connection.prototype.send=function(message){if(Object.prototype.toString.call(message)==="[object Object]"){var appKey=this.context.appKey||"";var toJid=appKey+"_"+message.to+"@"+this.domain;if(message.group){toJid=appKey+"_"+message.to+"@conference."+this.domain}if(message.resource){toJid=toJid+"/"+message.resource}message.toJid=toJid;message.id=message.id||this.getUniqueId();_msgHash[message.id]=new _message(message);_msgHash[message.id].send(this)}else{if(typeof message==="string"){_msgHash[message]&&_msgHash[message].send(this)}}};connection.prototype.addRoster=function(options){var jid=_getJid(options,this);var name=options.name||"";var groups=options.groups||"";var iq=$iq({type:"set"});iq.c("query",{xmlns:"jabber:iq:roster"});iq.c("item",{jid:jid,name:name});if(groups){for(var i=0;i<groups.length;i++){iq.c("group").t(groups[i]).up()}}var suc=options.success||_utils.emptyfn;var error=options.error||_utils.emptyfn;this.context.stropheConn.sendIQ(iq.tree(),suc,error)};connection.prototype.removeRoster=function(options){var jid=_getJid(options,this);var iq=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:jid,subscription:"remove"});var suc=options.success||_utils.emptyfn;var error=options.error||_utils.emptyfn;this.context.stropheConn.sendIQ(iq,suc,error)};connection.prototype.getRoster=function(options){var conn=this;var dom=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"});var options=options||{};var suc=options.success||this.onRoster;var completeFn=function completeFn(ele){var rouster=[];var msgBodies=ele.getElementsByTagName("query");if(msgBodies&&msgBodies.length>0){var queryTag=msgBodies[0];rouster=_parseFriend(queryTag)}suc(rouster,ele)};var error=options.error||this.onError;var failFn=function failFn(ele){error({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:ele})};if(this.isOpened()){this.context.stropheConn.sendIQ(dom.tree(),completeFn,failFn)}else{error({type:_code.WEBIM_CONNCTION_DISCONNECTED})}};connection.prototype.subscribe=function(options){var jid=_getJid(options,this);var pres=$pres({to:jid,type:"subscribe"});if(options.message){pres.c("status").t(options.message).up()}if(options.nick){pres.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(options.nick)}this.sendCommand(pres.tree())};connection.prototype.subscribed=function(options){var jid=_getJid(options,this);var pres=$pres({to:jid,type:"subscribed"});if(options.message){pres.c("status").t(options.message).up()}this.sendCommand(pres.tree())};connection.prototype.unsubscribe=function(options){var jid=_getJid(options,this);var pres=$pres({to:jid,type:"unsubscribe"});if(options.message){pres.c("status").t(options.message)}this.sendCommand(pres.tree())};connection.prototype.unsubscribed=function(options){var jid=_getJid(options,this);var pres=$pres({to:jid,type:"unsubscribed"});if(options.message){pres.c("status").t(options.message).up()}this.sendCommand(pres.tree())};connection.prototype.createRoom=function(options){var suc=options.success||_utils.emptyfn;var err=options.error||_utils.emptyfn;var roomiq;roomiq=$iq({to:options.rooomName,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"});return this.context.stropheConn.sendIQ(roomiq.tree(),suc,err)};connection.prototype.join=function(options){var roomJid=this.context.appKey+"_"+options.roomId+"@conference."+this.domain;var room_nick=roomJid+"/"+this.context.userId;var suc=options.success||_utils.emptyfn;var err=options.error||_utils.emptyfn;var errorFn=function errorFn(ele){err({type:_code.WEBIM_CONNCTION_JOINROOM_ERROR,data:ele})};var iq=$pres({from:this.context.jid,to:room_nick}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(iq.tree(),suc,errorFn)};connection.prototype.listRooms=function(options){var iq=$iq({to:options.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS});var suc=options.success||_utils.emptyfn;var error=options.error||this.onError;var completeFn=function completeFn(result){var rooms=[];rooms=_parseRoom(result);try{suc(rooms)}catch(e){error({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})}};var err=options.error||_utils.emptyfn;var errorFn=function errorFn(ele){err({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:ele})};this.context.stropheConn.sendIQ(iq.tree(),completeFn,errorFn)};connection.prototype.queryRoomMember=function(options){var domain=this.domain;var members=[];var iq=$iq({to:this.context.appKey+"_"+options.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"});var suc=options.success||_utils.emptyfn;var completeFn=function completeFn(result){var items=result.getElementsByTagName("item");if(items){for(var i=0;i<items.length;i++){var item=items[i];var mem={jid:item.getAttribute("jid"),affiliation:"member"};members.push(mem)}}suc(members)};var err=options.error||_utils.emptyfn;var errorFn=function errorFn(ele){err({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:ele})};this.context.stropheConn.sendIQ(iq.tree(),completeFn,errorFn)};connection.prototype.queryRoomInfo=function(options){var domain=this.domain;var iq=$iq({to:this.context.appKey+"_"+options.roomId+"@conference."+domain,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO});var suc=options.success||_utils.emptyfn;var members=[];var completeFn=function completeFn(result){var fields=result.getElementsByTagName("field");if(fields){for(var i=0;i<fields.length;i++){var field=fields[i];if(field.getAttribute("label")==="owner"){var mem={jid:(field.textContent||field.text)+"@"+domain,affiliation:"owner"};members.push(mem)}}}suc(members)};var err=options.error||_utils.emptyfn;var errorFn=function errorFn(ele){err({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:ele})};this.context.stropheConn.sendIQ(iq.tree(),completeFn,errorFn)};connection.prototype.queryRoomOccupants=function(options){var suc=options.success||_utils.emptyfn;var completeFn=function completeFn(result){var occupants=[];occupants=_parseRoomOccupants(result);suc(occupants)};var err=options.error||_utils.emptyfn;var errorFn=function errorFn(ele){err({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:ele})};var attrs={xmlns:Strophe.NS.DISCO_ITEMS};var info=$iq({from:this.context.jid,to:this.context.appKey+"_"+options.roomId+"@conference."+this.domain,type:"get"}).c("query",attrs);this.context.stropheConn.sendIQ(info.tree(),completeFn,errorFn)};connection.prototype.setUserSig=function(desc){var dom=$pres({xmlns:"jabber:client"});desc=desc||"";dom.c("status").t(desc);this.sendCommand(dom.tree())};connection.prototype.setPresence=function(type,status){var dom=$pres({xmlns:"jabber:client"});if(type){if(status){dom.c("show").t(type);dom.up().c("status").t(status)}else{dom.c("show").t(type)}}this.sendCommand(dom.tree())};connection.prototype.getPresence=function(){var dom=$pres({xmlns:"jabber:client"});var conn=this;this.sendCommand(dom.tree())};connection.prototype.ping=function(options){var options=options||{};var jid=_getJid(options,this);var dom=$iq({from:this.context.jid||"",to:jid,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"});var suc=options.success||_utils.emptyfn;var error=options.error||this.onError;var failFn=function failFn(ele){error({type:_code.WEBIM_CONNCTION_PING_ERROR,data:ele})};if(this.isOpened()){this.context.stropheConn.sendIQ(dom.tree(),suc,failFn)}else{error({type:_code.WEBIM_CONNCTION_DISCONNECTED})}return};connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED};connection.prototype.isOpening=function(){var status=this.context.status;return status==_code.STATUS_DOLOGIN_USERGRID||status==_code.STATUS_DOLOGIN_IM};connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING};connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED};connection.prototype.clear=function(){var key=this.context.appKey;this.context={status:_code.STATUS_INIT,appKey:key}};connection.prototype.getChatRooms=function(options){if(!_utils.isCanSetRequestHeader){conn.onError({type:_code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR});return}var conn=this,token=options.accessToken||this.context.accessToken;if(token){var apiUrl=options.apiUrl;var appName=this.context.appName;var orgName=this.context.orgName;if(!appName||!orgName){conn.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});return}var suc=function suc(data,xhr){typeof options.success==="function"&&options.success(data)};var error=function error(res,xhr,msg){if(res.error&&res.error_description){conn.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:res.error_description,data:res,xhr:xhr})}};var opts={url:apiUrl+"/"+orgName+"/"+appName+"/chatrooms",dataType:"json",type:"get",headers:{Authorization:"Bearer "+token},success:suc||_utils.emptyfn,error:error||_utils.emptyfn};_utils.ajax(opts)}else{conn.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})}};connection.prototype.joinChatRoom=function(options){var roomJid=this.context.appKey+"_"+options.roomId+"@conference."+this.domain;var room_nick=roomJid+"/"+this.context.userId;var suc=options.success||_utils.emptyfn;var err=options.error||_utils.emptyfn;var errorFn=function errorFn(ele){err({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:ele})};var iq=$pres({from:this.context.jid,to:room_nick}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(iq.tree(),suc,errorFn)};connection.prototype.quitChatRoom=function(options){var roomJid=this.context.appKey+"_"+options.roomId+"@conference."+this.domain;var room_nick=roomJid+"/"+this.context.userId;var suc=options.success||_utils.emptyfn;var err=options.error||_utils.emptyfn;var errorFn=function errorFn(ele){err({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:ele})};var iq=$pres({from:this.context.jid,to:room_nick,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(iq.tree(),suc,errorFn)};window.WebIM=typeof WebIM!=="undefined"?WebIM:{};WebIM.connection=connection;WebIM.utils=_utils;WebIM.statusCode=_code;WebIM.message=_msg.message})(window,undefined)},210:function(b,a){(function(){var f=0,d=100,e=200,g=300,c=400;a.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:f++,WEBIM_CONNCTION_OPEN_ERROR:f++,WEBIM_CONNCTION_AUTH_ERROR:f++,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:f++,WEBIM_CONNCTION_ATTACH_ERROR:f++,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:f++,WEBIM_CONNCTION_REOPEN_ERROR:f++,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:f++,WEBIM_CONNCTION_SERVER_ERROR:f++,WEBIM_CONNCTION_IQ_ERROR:f++,WEBIM_CONNCTION_PING_ERROR:f++,WEBIM_CONNCTION_NOTIFYVERSION_ERROR:f++,WEBIM_CONNCTION_GETROSTER_ERROR:f++,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:f++,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:f++,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:f++,WEBIM_CONNCTION_DISCONNECTED:f++,WEBIM_CONNCTION_AJAX_ERROR:f++,WEBIM_CONNCTION_JOINROOM_ERROR:f++,WEBIM_CONNCTION_GETROOM_ERROR:f++,WEBIM_CONNCTION_GETROOMINFO_ERROR:f++,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:f++,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:f++,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:f++,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:f++,WEBIM_CONNCTION_JOINCHATROOM_ERROR:f++,WEBIM_CONNCTION_QUITCHATROOM_ERROR:f++,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:f++,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:f++,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:f++,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:f++,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:f++,WEBIM_UPLOADFILE_BROWSER_ERROR:d++,WEBIM_UPLOADFILE_ERROR:d++,WEBIM_UPLOADFILE_NO_LOGIN:d++,WEBIM_UPLOADFILE_NO_FILE:d++,WEBIM_DOWNLOADFILE_ERROR:e++,WEBIM_DOWNLOADFILE_NO_LOGIN:e++,WEBIM_DOWNLOADFILE_BROWSER_ERROR:e++,WEBIM_MESSAGE_REC_TEXT:g++,WEBIM_MESSAGE_REC_TEXT_ERROR:g++,WEBIM_MESSAGE_REC_EMOTION:g++,WEBIM_MESSAGE_REC_PHOTO:g++,WEBIM_MESSAGE_REC_AUDIO:g++,WEBIM_MESSAGE_REC_AUDIO_FILE:g++,WEBIM_MESSAGE_REC_VEDIO:g++,WEBIM_MESSAGE_REC_VEDIO_FILE:g++,WEBIM_MESSAGE_REC_FILE:g++,WEBIM_MESSAGE_SED_TEXT:g++,WEBIM_MESSAGE_SED_EMOTION:g++,WEBIM_MESSAGE_SED_PHOTO:g++,WEBIM_MESSAGE_SED_AUDIO:g++,WEBIM_MESSAGE_SED_AUDIO_FILE:g++,WEBIM_MESSAGE_SED_VEDIO:g++,WEBIM_MESSAGE_SED_VEDIO_FILE:g++,WEBIM_MESSAGE_SED_FILE:g++,STATUS_INIT:c++,STATUS_DOLOGIN_USERGRID:c++,STATUS_DOLOGIN_IM:c++,STATUS_OPENED:c++,STATUS_CLOSING:c++,STATUS_CLOSED:c++}})()},211:function(b,a,d){var c=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol?"symbol":typeof e};(function(){var f=function f(){},A=d(210).code,v;var H=function H(){try{return new window.XMLHttpRequest()}catch(J){return false}};var s=function s(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(J){return false}};var r=function r(K){K=K||true;var J=H()||s();if("withCredentials" in J){return J}if(!K){return J}if(typeof window.XDomainRequest==="undefined"){return J}var L=new XDomainRequest();L.readyState=0;L.status=100;L.onreadystatechange=f;L.onload=function(){L.readyState=4;L.status=200;var M=new ActiveXObject("Microsoft.XMLDOM");M.async="false";M.loadXML(L.responseText);L.responseXML=M;L.response=L.responseText;L.onreadystatechange()};L.ontimeout=L.onerror=function(){L.readyState=4;L.status=500;L.onreadystatechange()};return L};var m=function(){if("ActiveXObject" in window){try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(J){return 0}}else{if(navigator.plugins&&navigator.plugins.length>0){return navigator.plugins["Shockwave Flash"]}}return 0}();var k=r(),w=typeof FormData!=="undefined",l=typeof Blob!=="undefined",C=k.setRequestHeader||false,I=k.overrideMimeType||false,x=C&&w,g=x||m,p=C&&(l||I);var F={hasFormData:w,hasBlob:l,emptyfn:f,isCanSetRequestHeader:C,hasOverrideMimeType:I,isCanUploadFileAsync:x,isCanUploadFile:g,isCanDownLoadFile:p,isSupportWss:function(){var M=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!window.WebSocket){return false}var L=window.navigator.userAgent;for(var K=0,J=M.length;K<J;K++){if(M[K].test(L)){return false}}return true}(),getIEVersion:function(){var K=navigator.userAgent,L,J={"4":8,"5":9,"6":10,"7":11};L=K.match(/MSIE (\d+)/i);if(L&&L[1]){return +L[1]}L=K.match(/Trident\/(\d+)/i);if(L&&L[1]){return J[L[1]]||null}return null}(),stringify:function B(L){if(typeof JSON!=="undefined"&&JSON.stringify){return JSON.stringify(L)}else{var M="",J=[];var K=function K(N){var O=false;if(Object.prototype.toString.call(N)==="[object Array]"){J.push("]","[");O=true}else{if(Object.prototype.toString.call(N)==="[object Object]"){J.push("}","{")}}for(var P in N){if(Object.prototype.toString.call(N[P])==="[object Null]"){N[P]="null"}else{if(Object.prototype.toString.call(N[P])==="[object Undefined]"){N[P]="undefined"}}if(N[P]&&c(N[P])==="object"){M+=","+(O?"":'"'+P+'":'+(O?'"':""))+K(N[P])+""}else{M+=',"'+(O?"":P+'":"')+N[P]+'"'}}if(M!=""){M=M.slice(1)}return J.pop()+M+J.pop()};return K(L)}},registerUser:function o(U){var P=U.orgName||"";var N=U.appName||"";var Q=U.appKey||"";var T=U.success||f;var K=U.error||f;if(!P&&!N&&Q){var M=Q.split("#");if(M.length===2){P=M[0];N=M[1]}}if(!P&&!N){K({type:A.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});return}var S=U.https||S;var R=U.apiUrl;var O=R+"/"+P+"/"+N+"/users";var J={username:U.username,password:U.password,nickname:U.nickname||""};var L=F.stringify(J);var U={url:O,dataType:"json",data:L,success:T,error:K};return F.ajax(U)},login:function u(V){var V=V||{};var U=V.success||f;var J=V.error||f;var Q=V.appKey||"";var L=Q.split("#");if(L.length!==2){J({type:A.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});return false}var P=L[0];var N=L[1];var S=S||V.https;var K=V.user||"";var M=V.pwd||"";var R=V.apiUrl;var O={grant_type:"password",username:K,password:M};var T=F.stringify(O);var V={url:R+"/"+P+"/"+N+"/token",dataType:"json",data:T,success:U,error:J};return F.ajax(V)},getFileUrl:function i(M){var J={url:"",filename:"",filetype:"",data:""};var K=typeof M==="string"?document.getElementById(M):M;if(!F.isCanUploadFileAsync||!K){return J}try{if(window.URL.createObjectURL){var L=K.files;if(L.length>0){var S=L.item(0);J.data=S;J.url=window.URL.createObjectURL(S);J.filename=S.name||""}}else{var S=document.getElementById(M).value;J.url=S;var R=S.lastIndexOf("/");var Q=S.lastIndexOf("\\");var P=Math.max(R,Q);if(P<0){J.filename=S}else{J.filename=S.substring(P+1)}}var N=J.filename.lastIndexOf(".");if(N!=-1){J.filetype=J.filename.substring(N+1).toLowerCase()}return J}catch(O){throw O}},getFileSize:function q(L){var K=document.getElementById(L);var J=0;if(K){if(K.files){if(K.files.length>0){J=K.files[0].size}}else{if(K.select&&"ActiveXObject" in window){K.select();var M=new ActiveXObject("Scripting.FileSystemObject");var K=M.GetFile(K.value);J=K.Size}}}return J},hasFlash:m,trim:function D(J){J=typeof J==="string"?J:"";return J.trim?J.trim():J.replace(/^\s|\s$/g,"")},parseEmoji:function G(M){if(typeof WebIM.Emoji==="undefined"||typeof WebIM.Emoji.map==="undefined"){return M}else{var L=WebIM.Emoji,J=null;for(var K in L.map){if(L.map.hasOwnProperty(K)){while(M.indexOf(K)>-1){M=M.replace(K,'<img class="emoji" src="'+L.path+L.map[K]+'" />')}}}return M}},parseLink:function n(N){var K=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-/=]*/gm;var J=N.match(K);var M=J&&J[0]?J[0]:"";if(J&&J.length){var L=/^https?:\/\//.test(M);N=N.replace(K,"<a href='"+(L?M:"//"+M)+"' target='_blank'>"+M+"</a>")}return N},parseJSON:function e(J){if(window.JSON&&window.JSON.parse){return window.JSON.parse(J+"")}var M,L=null,K=F.trim(J+"");return K&&!F.trim(K.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(P,N,O,Q){if(M&&N){L=0}if(L===0){return P}M=O||N;L+=!Q-!O;return""}))?Function("return "+K)():Function("Invalid JSON: "+J)()},parseUploadResponse:function z(J){return J.indexOf("callback")>-1?J.slice(9,-1):J},parseDownloadResponse:function y(J){return J&&J.type&&J.type==="application/json"||0>Object.prototype.toString.call(J).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(J)},uploadFile:function j(U){var U=U||{};U.onFileUploadProgress=U.onFileUploadProgress||f;U.onFileUploadComplete=U.onFileUploadComplete||f;U.onFileUploadError=U.onFileUploadError||f;U.onFileUploadCanceled=U.onFileUploadCanceled||f;var L=U.accessToken||this.context.accessToken;if(!L){U.onFileUploadError({type:A.WEBIM_UPLOADFILE_NO_LOGIN,id:U.id});return}var P,O,N;var Q=U.appKey||this.context.appKey||"";if(Q){N=Q.split("#");P=N[0];O=N[1]}if(!P&&!O){U.onFileUploadError({type:A.WEBIM_UPLOADFILE_ERROR,id:U.id});return}var S=U.apiUrl;var R=S+"/"+P+"/"+O+"/chatfiles";if(!F.isCanUploadFileAsync){if(F.hasFlash&&typeof U.flashUpload==="function"){U.flashUpload&&U.flashUpload(R,U)}else{U.onFileUploadError({type:A.WEBIM_UPLOADFILE_BROWSER_ERROR,id:U.id})}return}var K=U.file.data?U.file.data.size:undefined;if(K>v){U.onFileUploadError({type:A.WEBIM_UPLOADFILE_ERROR,id:U.id});return}else{if(K<=0){U.onFileUploadError({type:A.WEBIM_UPLOADFILE_ERROR,id:U.id});return}}var T=F.xmlrequest();var M=function M(V){U.onFileUploadError({type:A.WEBIM_UPLOADFILE_ERROR,id:U.id,xhr:T})};if(T.upload){T.upload.addEventListener("progress",U.onFileUploadProgress,false)}if(T.addEventListener){T.addEventListener("abort",U.onFileUploadCanceled,false);T.addEventListener("load",function(W){try{var V=F.parseJSON(T.responseText);try{U.onFileUploadComplete(V)}catch(W){U.onFileUploadError({type:A.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:W})}}catch(W){U.onFileUploadError({type:A.WEBIM_UPLOADFILE_ERROR,data:T.responseText,id:U.id,xhr:T})}},false);T.addEventListener("error",M,false)}else{if(T.onreadystatechange){T.onreadystatechange=function(){if(T.readyState===4){if(t.status===200){try{var V=F.parseJSON(T.responseText);U.onFileUploadComplete(V)}catch(W){U.onFileUploadError({type:A.WEBIM_UPLOADFILE_ERROR,data:T.responseText,id:U.id,xhr:T})}}else{U.onFileUploadError({type:A.WEBIM_UPLOADFILE_ERROR,data:T.responseText,id:U.id,xhr:T})}}else{T.abort();U.onFileUploadCanceled()}}}}T.open("POST",R);T.setRequestHeader("restrict-access","true");T.setRequestHeader("Accept","*/*");T.setRequestHeader("Authorization","Bearer "+L);var J=new FormData();J.append("file",U.file.data);T.send(J)},download:function h(S){S.onFileDownloadComplete=S.onFileDownloadComplete||f;S.onFileDownloadError=S.onFileDownloadError||f;var O=S.accessToken||this.context.accessToken;if(!O){S.onFileDownloadError({type:A.WEBIM_DOWNLOADFILE_NO_LOGIN,id:S.id});return}var N=function N(T){S.onFileDownloadError({type:A.WEBIM_DOWNLOADFILE_ERROR,id:S.id,xhr:R})};if(!F.isCanDownLoadFile){S.onFileDownloadComplete();return}var R=F.xmlrequest();if("addEventListener" in R){R.addEventListener("load",function(T){S.onFileDownloadComplete(R.response,R)},false);R.addEventListener("error",N,false)}else{if("onreadystatechange" in R){R.onreadystatechange=function(){if(R.readyState===4){if(t.status===200){S.onFileDownloadComplete(R.response,R)}else{S.onFileDownloadError({type:A.WEBIM_DOWNLOADFILE_ERROR,id:S.id,xhr:R})}}else{R.abort();S.onFileDownloadError({type:A.WEBIM_DOWNLOADFILE_ERROR,id:S.id,xhr:R})}}}}var J=S.method||"GET";var Q=S.responseType||"blob";var K=S.mimeType||"text/plain; charset=x-user-defined";R.open(J,S.url);if(typeof Blob!=="undefined"){R.responseType=Q}else{R.overrideMimeType(K)}var L={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":S.secret,Authorization:"Bearer "+O};var M=S.headers||{};for(var P in M){L[P]=M[P]}for(var P in L){if(L[P]){R.setRequestHeader(P,L[P])}}R.send(null)},parseTextMessage:function E(U,K){if(typeof U!=="string"||typeof K==="undefined"){return}if(Object.prototype.toString.call(K)!=="[object Object]"){return{isemoji:false,body:[{type:"txt",data:U}]}}var O=U;var R=[];var Q=/\[[^[\]]{2,3}\]/mg;var N=O.match(Q);if(!N||N.length<1){return{isemoji:false,body:[{type:"txt",data:U}]}}var P=false;for(var M=0;M<N.length;M++){var T=O.substring(0,O.indexOf(N[M])),S=WebIM.Emoji.map[N[M]];if(T){R.push({type:"txt",data:T})}if(!S){R.push({type:"txt",data:N[M]});continue}var J=WebIM.Emoji.map?WebIM.Emoji.path+S:null;if(J){P=true;R.push({type:"emoji",data:J})}else{R.push({type:"txt",data:N[M]})}var L=O.indexOf(N[M])+N[M].length;O=O.substring(L)}if(O){R.push({type:"txt",data:O})}if(P){return{isemoji:P,body:R}}return{isemoji:false,body:[{type:"txt",data:U}]}},xmlrequest:r,ajax:function t(T){var P=T.dataType||"text";var S=T.success||f;var O=T.error||f;var R=F.xmlrequest();R.onreadystatechange=function(){if(R.readyState===4){var U=R.status||0;if(U===200){try{switch(P){case"text":S(R.responseText);return;case"json":var V=F.parseJSON(R.responseText);S(V,R);return;case"xml":if(R.responseXML&&R.responseXML.documentElement){S(R.responseXML.documentElement,R)}else{O({type:A.WEBIM_CONNCTION_AJAX_ERROR,data:R.responseText})}return}S(R.response||R.responseText,R)}catch(W){O({type:A.WEBIM_CONNCTION_AJAX_ERROR,data:W})}return}else{O({type:A.WEBIM_CONNCTION_AJAX_ERROR,data:R.responseText});return}}if(R.readyState===0){O({type:A.WEBIM_CONNCTION_AJAX_ERROR,data:R.responseText})}};if(T.responseType){if(R.responseType){R.responseType=T.responseType}}if(T.mimeType){if(F.hasOverrideMimeType){R.overrideMimeType(T.mimeType)}}var N=T.type||"POST",L=T.data||null,M="";if(N.toLowerCase()==="get"&&L){for(var J in L){if(L.hasOwnProperty(J)){M+=J+"="+L[J]+"&"}}M=M?M.slice(0,-1):M;T.url+=(T.url.indexOf("?")>0?"&":"?")+(M?M+"&":M)+"_v="+new Date().getTime();L=null,M=null}R.open(N,T.url);if(F.isCanSetRequestHeader){var K=T.headers||{};for(var Q in K){if(K.hasOwnProperty(Q)){R.setRequestHeader(Q,K[Q])}}}R.send(L);return R}};a.utils=F})()},212:function(b,a,c){(function(){var f=c(211).utils;var e=function e(g,h){if(!this instanceof e){return new e(g)}this._msg={};if(typeof e[g]==="function"){e[g].prototype.setGroup=this.setGroup;this._msg=new e[g](h)}return this._msg};e.prototype.setGroup=function(g){this.body.group=g};e.txt=function(g){this.id=g;this.type="txt";this.body={}};e.txt.prototype.set=function(g){this.value=g.msg;this.body={id:this.id,to:g.to,msg:this.value,type:this.type,roomType:g.roomType,ext:g.ext||{},success:g.success,fail:g.fail};!g.roomType&&delete this.body.roomType};e.cmd=function(g){this.id=g;this.type="cmd";this.body={}};e.cmd.prototype.set=function(g){this.value="";this.body={to:g.to,action:g.action,msg:this.value,type:this.type,roomType:g.roomType,ext:g.ext||{}};!g.roomType&&delete this.body.roomType};e.location=function(g){this.id=g;this.type="loc";this.body={}};e.location.prototype.set=function(g){this.body={to:g.to,type:this.type,roomType:g.roomType,addr:g.addr,lat:g.lat,lng:g.lng,ext:g.ext||{}}};e.img=function(g){this.id=g;this.type="img";this.body={}};e.img.prototype.set=function(g){g.file=g.file||f.getFileUrl(g.fileInputId);this.value=g.file;this.body={id:this.id,file:this.value,apiUrl:g.apiUrl,to:g.to,type:this.type,ext:g.ext||{},roomType:g.roomType,onFileUploadError:g.onFileUploadError,onFileUploadComplete:g.onFileUploadComplete,success:g.success,fail:g.fail,flashUpload:g.flashUpload,body:g.body};!g.roomType&&delete this.body.roomType};e.audio=function(g){this.id=g;this.type="audio";this.body={}};e.audio.prototype.set=function(g){g.file=g.file||f.getFileUrl(g.fileInputId);this.value=g.file;this.filename=g.filename||this.value.filename;this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:g.apiUrl,to:g.to,type:this.type,ext:g.ext||{},length:g.length||0,roomType:g.roomType,file_length:g.file_length,onFileUploadError:g.onFileUploadError,onFileUploadComplete:g.onFileUploadComplete,success:g.success,fail:g.fail,flashUpload:g.flashUpload,body:g.body};!g.roomType&&delete this.body.roomType};e.file=function(g){this.id=g;this.type="file";this.body={}};e.file.prototype.set=function(g){g.file=g.file||f.getFileUrl(g.fileInputId);this.value=g.file;this.filename=g.filename||this.value.filename;this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:g.apiUrl,to:g.to,type:this.type,ext:g.ext||{},roomType:g.roomType,onFileUploadError:g.onFileUploadError,onFileUploadComplete:g.onFileUploadComplete,success:g.success,fail:g.fail,flashUpload:g.flashUpload,body:g.body};!g.roomType&&delete this.body.roomType};e.video=function(g){};e.video.prototype.set=function(g){};var d=function d(g){if(!this instanceof d){return new d(g,conn)}this.msg=g};d.prototype.send=function(k){var j=this;var i=function i(n){n.ext=n.ext||{};n.ext.weichat=n.ext.weichat||{};n.ext.weichat.originType=n.ext.weichat.originType||"webim";var m={from:k.context.userId||"",to:n.to,bodies:[n.body],ext:n.ext||{}};var l=f.stringify(m);var o=$msg({type:n.group||"chat",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(l);if(n.roomType){o.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"})}k.retry&&setTimeout(function(){if(typeof _msgHash!=="undefined"&&_msgHash[n.id]){if(typeof _msgHash[n.id].timeout==="undefined"){_msgHash[n.id].timeout=2}if(_msgHash[n.id].timeout===0){_msgHash[n.id].timeout=2;_msgHash[n.id].msg.fail instanceof Function&&_msgHash[n.id].msg.fail(n.id)}else{_msgHash[n.id].timeout-=1;i(n)}}},20000);k.sendCommand(o.tree(),n.id)};if(j.msg.file){if(j.msg.body&&j.msg.body.url){i(j.msg);return}var g=j.msg.onFileUploadComplete;var h=function h(m){if(m.entities[0]["file-metadata"]){var l=m.entities[0]["file-metadata"]["content-length"];j.msg.file_length=l;j.msg.filetype=m.entities[0]["file-metadata"]["content-type"];if(l>204800){j.msg.thumbnail=true}}j.msg.body={type:j.msg.type||"file",url:m.uri+"/"+m.entities[0]["uuid"],secret:m.entities[0]["share-secret"],filename:j.msg.file.filename||j.msg.filename,size:{width:j.msg.width||0,height:j.msg.height||0},length:j.msg.length||0,file_length:j.msg.file_length||0,filetype:j.msg.filetype};i(j.msg);g instanceof Function&&g(m,j.msg.id)};j.msg.onFileUploadComplete=h;f.uploadFile.call(k,j.msg)}else{j.msg.body={type:j.msg.type==="chat"?"txt":j.msg.type,msg:j.msg.msg};if(j.msg.type==="cmd"){j.msg.body.action=j.msg.action}else{if(j.msg.type==="loc"){j.msg.body.addr=j.msg.addr;j.msg.body.lat=j.msg.lat;j.msg.body.lng=j.msg.lng}}i(j.msg)}};a._msg=d;a.message=e})()}});